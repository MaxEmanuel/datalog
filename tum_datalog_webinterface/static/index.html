<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<link rel="stylesheet" href="http://www-db.in.tum.de/dbstyle.css" type="text/css">
<title>TUM Informatik III: Datenbanksysteme</title>
<script src="/jquery-1.10.0.min.js" type="text/javascript"></script>
<script type="text/javascript">
	var examples = [];

	var runQuery = function() {
		$("#queryButton").attr("disabled", "disabled");
		
		var gotResponseFromServer = false;
		setTimeout(function() {
			if (!gotResponseFromServer) {
				$("#queryButton").removeAttr("disabled");
				$("#answerTextArea").val("Connection timed out.");
			}
		}, 30000);
		var jsonRequest = {
			"ruleset" : $("#rulesetTextArea").val(),
			"query" : $("#queryTextArea").val()
		}
		$("#answerTextArea").val("Einen Moment bitte. Ihre Anfrage wird verarbeitet...");

		$.ajax({
			type : "POST",
			url : "/datalog",
			data : jsonRequest,
			success : function(data) {
				gotResponseFromServer = true;
				$("#queryButton").removeAttr("disabled");
				if (data.error) {
					$("#answerTextArea").val(data.error);
				} else {
					$("#answerTextArea").val(data.answer);
				}
			},
			failure : function(errMsg) {
				gotResponseFromServer = true;
				$("#queryButton").removeAttr("disabled");
				alert(errMsg);
			}
		});
	}
	
	var updateExampleList = function() {
		var sel = $("#exampleSelect");
		sel.empty();
		for (var i = 0; i < examples.length; i++) {
			sel.append($("<option></option>").attr("value", i).text(examples[i].name));
		}
		$("#loadButton").removeAttr("disabled");
	}

	var loadExample = function() {
		$("#loadButton").attr("disabled", "disabled");
		var exampleNum = $('#exampleSelect').find(":selected").val();
		$.ajax({
			type : "GET",
			url : examples[exampleNum].url,
			success : function(data) {
				$("#loadButton").removeAttr("disabled");
				var rules = "";
				data.ruleset.forEach(function(rule) {
					rules += rule + "\n";
				})
				$("#rulesetTextArea").val(rules);
				$("#queryTextArea").val(data.query);
				$("#answerTextArea").val("");
			},
			failure : function(errMsg) {
				$("#loadButton").removeAttr("disabled");
				alert(errMsg);
			}
		});
		$("#loadButton").removeAttr("disabled");
	}
	
	// initializations
	$(document).ready(function() {
		// bind button events 
		$("#queryButton").click(function(event) {
			runQuery();
		});
		$("#loadButton").click(function(event) {
			loadExample();
		});

		// load examples
		$.ajax({
			type : "GET",
			url : "/examples",
			success : function(data) {
				examples = data;
				updateExampleList();
			},
			failure : function(errMsg) {
			}
		});
	});
</script>
</head>

<body>

	<div style="padding: 4pt; margin-left: 4pt">
		<table>
			<tr>
				<td align="left" valign="middle"><a href="http://www.in.tum.de">
						<img src="http://www-db.in.tum.de/images/Fakultaet_logo_102.png"
						alt="Fakult&auml;t f&uuml;r Informatik">
				</a></td>
				<td align="center" valign="middle" class="nowrap">
					<span style="color: #A1A1A1; font-size: x-large">TU M&uuml;nchen - Fakult&auml;t f&uuml;r</span> 
					<span	style="color: #0075CF; font-size: x-large">Informatik</span>
					<span	style="font-size: x-large"><br></span> 
					<span style="color: #A1A1A1; font-size: x-large">Lehrstuhl III:	Datenbanksysteme</span>
				</td>
				<td align="right" valign="middle">
				  <a href="http://www.tum.de">
						<img src="http://www-db.in.tum.de/images/TUM-Logo-102.png" alt="Technische Universit&auml;t M&uuml;nchen">
				  </a>
				</td>
			</tr>
		</table>
	</div>
	<div
		style="padding: 4pt; margin-left: 4pt; background-color: #dddddd; margin-bottom: 8pt">
		<a href="http://www-db.in.tum.de/">Home</a>&nbsp; |&nbsp; 
		<a href="http://www-db.in.tum.de/people/">Personen</a>&nbsp; |&nbsp; 
		<a href="http://www-db.in.tum.de/research/projects">Forschung</a>&nbsp; |&nbsp; 
		<a href="http://www-db.in.tum.de/teaching">Lehre</a>&nbsp; |&nbsp; 
		<a href="http://www-db.in.tum.de/other/">Sonstiges</a>&nbsp;|&nbsp;
	</div>


	<div align="center">
		<p>
			<font color="#808080" size="+2">Datalog Schnittstelle (BETA)</font>
		</p>
	</div>

	<div id="datalogTop" style="width:75%;margin:0px auto;">
	
		<div id="datalogExamples">
			 Beispiele:
			 <select id="exampleSelect" name="example" size="1">
		      <option value="n/a">Nicht verf&uuml;gbar</option>
		    </select>
		    <button id="loadButton" disabled>Laden</button>
		</div>
		
		<hr style="clear: both">

		<div id="datalogForm">
		  Fakten und Regeln:<br />
			<textarea id="rulesetTextArea" rows="20" cols="80" name="ruleset" style="width:100%;font-family:monospace"></textarea>
			<br><br> Anfrage:<br /> 
			<textarea id="queryTextArea" rows="4" cols="80" name="query" style="width:100%;font-family:monospace"></textarea>
			<div align="center">
			  <button id="queryButton">Anfrage abschicken</button>
			</div>

			<div id="datalogAnswer">
				<div>
					<br>
					Antwort:<br>
					<textarea id="answerTextArea" rows="20" cols="80" style="width:100%;font-family:monospace" readonly>
Es wurde noch keine Anfrage abgeschickt.
					</textarea>
				</div>
			</div>
		</div>

	</div>

	<hr style="clear: both">
	
</body>
</html>